parameters:
  - name: working_directory
  - name: terraform_parameters
    default: ""
  - name: terraform_backend_config
  - name: subscription_id
  - name: service_principal_id
  - name: service_principal_secret
  - name: tenant_id

steps:
  - template: tf-init.yml
    parameters:
      working_directory: ${{ parameters.working_directory }}
      terraform_backend_config: ${{ parameters.terraform_backend_config }}

  - bash: |
      terraform apply -auto-approve -no-color ${{ parameters.terraform_parameters }}
    displayName: "Terraform Apply"
    workingDirectory: ${{ parameters.working_directory }}
    env:
      ARM_SUBSCRIPTION_ID: ${{ parameters.subscription_id }}
      ARM_CLIENT_ID: ${{ parameters.service_principal_id }}
      ARM_CLIENT_SECRET: ${{ parameters.service_principal_secret }}
      ARM_TENANT_ID: ${{ parameters.tenant_id }}
